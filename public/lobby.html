<!DOCTYPE html>
<html lang="ko">
	<head>
		<title>가오수 World</title>
		<meta charset="UTF-8" />
		<link rel="stylesheet" href="stylesheet_lobby.css" />
		<script src="prefixfree.min.js"></script>
		<script src="http://code.jquery.com/jquery-1.10.2.js"></script>
		<script src="./socket.io/socket.io.js"></script>
		<script type="text/javascript" src="jquery.cookie.js"></script>
		<script>
			var socket = undefined;
			
			$(document).ready(function(){
				socket = io.connect();
				socket.emit('join_lobby');
				
				socket.on('lobby_chat_update', function(data){
					if(data.length > 0){
						$('.inner_chat').remove();
						for(var i=0; i<data.length; i++){
							addChat(data[i].name, data[i].str);
						}
						// alert(lobby_chat);
					}
				});
				
				socket.on('lobby_chat_error', function(){
					alert('잘못된 채팅입니다.');
				});
				
				$('#btn_logout').click(function(){
					location = "/logout";
				});
				
				$('#server1_1').click(function(){
					alert('준비중입니다.');
				});
				$('#server1_2').click(function(){
					alert('준비중입니다.');
				});
				$('#server1_3').click(function(){
					alert('준비중입니다.');
				});
				$('#server2_1').click(function(){
					alert('준비중입니다.');
				});
				$('#server2_2').click(function(){
					alert('준비중입니다.');
				});
				$('#server2_3').click(function(){
					alert('준비중입니다.');
				});
				$('#server3_1').click(function(){
					alert('준비도 안하고 있습니다.');
				});
				$('#server3_2').click(function(){
					alert('준비도 안하고 있습니다.');
				});
				$('#server3_3').click(function(){
					alert('준비도 안하고 있습니다.');
				});
				
				$('.btn_chat').click(function(){
					chat_input();
				});
			});
				
			$(document).unload(function(){
				socket.emit('disconnect_lobby');
				if (socket != undefined) socket.disconnect();
			});
			
			function chat_input(){
				var str = $('.input_chat').val();
				var session = $.cookie("session");
				if(str.length>0 && session.length>0){
					socket.emit('lobby_chat_add', {
						session: session,
						str: str
					});
				}
				$('.input_chat').val('');
			}
			
			function addChat(name, str){
				var nickname = $('#label_nickname').html();
				var chat = $('<div></div>').addClass('inner_chat');
				var label = $('<label></label>').addClass('label_chat').html(name+' : '+str);
				if(name == nickname){
					label.css({
						fontWeight: 'bold',
						color: '#000000'
					});
				}else if(name == "관리자"){
					label.css({
						fontWeight: 'bold',
						color: '#ff0000'
					});
				}else{
					label.css({
						color: '#000000'
					});
				}
				label.appendTo(chat);
				chat.appendTo($('.div_lobby_chat_body'));
				$('.div_lobby_chat_body').scrollTop($('.div_lobby_chat_body').prop('scrollHeight'));
			}
		</script>
	</head>
	<body>
		<div class="container">
			<img id="img_title" src="title.png"/>
			<div class="div_member">
				<div class="div_label">
					<label id="label_nickname" class="label_member"><%= data.nickname %></label>
					<label class="label_member">님 환영합니다.</label>
				</div>
				<button id="btn_logout">로그아웃</button>
			</div>
			<div class="div_game">
				<div class="div_gamedetail">
					<img src="game1.png"/>
					<div class="div_server">
						<div id="server1_1" class="div_servergo">
							<label class="label_servername">서버1</label>
							<label class="label_serverperson">(0/2)</label>
						</div>
						<div id="server1_2" class="div_servergo">
							<label class="label_servername">서버2</label>
							<label class="label_serverperson">(0/2)</label>
						</div>
						<div id="server1_3" class="div_servergo">
							<label class="label_servername">서버3</label>
							<label class="label_serverperson">(0/2)</label>
						</div>
					</div>
					<div class="div_gameinfo">
						<label class="label_gameinfo">서로가 만드는 미로를 뚫는 최강의 두뇌게임!</label>
					</div>
				</div>
				<div class="div_gamedetail">
					<img src="game2.png"/>
					<div class="div_server">
						<div id="server2_1" class="div_servergo">
							<label class="label_servername">서버1</label>
							<label class="label_serverperson">(0/8)</label>
						</div>
						<div id="server2_2" class="div_servergo">
							<label class="label_servername">서버2</label>
							<label class="label_serverperson">(0/8)</label>
						</div>
						<div id="server2_3" class="div_servergo">
							<label class="label_servername">서버3</label>
							<label class="label_serverperson">(0/8)</label>
						</div>
					</div>
					<div class="div_gameinfo">
						<label class="label_gameinfo">미소녀가 펼치는 아슬아슬 캐주얼 골프!</label>
					</div>
				</div>
				<div class="div_gamedetail">
					<img src="game3.png"/>
					<div class="div_server">
						<div id="server3_1" class="div_servergo">
							<label class="label_servername">서버1</label>
							<label class="label_serverperson">(0/2)</label>
						</div>
						<div id="server3_2" class="div_servergo">
							<label class="label_servername">서버2</label>
							<label class="label_serverperson">(0/2)</label>
						</div>
						<div id="server3_3" class="div_servergo">
							<label class="label_servername">서버3</label>
							<label class="label_serverperson">(0/2)</label>
						</div>
					</div>
					<div class="div_gameinfo">
						<label class="label_gameinfo">전설의 영웅들이 펼치는 마지막 TCG!</label>
					</div>
				</div>
				<div class="div_lobby_chat">
					<div class="div_lobby_chat_body" style="overflow:auto">
					</div>
					<div class="div_lobby_chat_input">
						<input class="input_chat" onkeydown="javascript:if (event.keyCode == 13) chat_input()"/>
						<button class="btn_chat">입력</button>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>